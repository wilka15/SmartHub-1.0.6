<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SmartHub AI</title>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #0b0f19, #1b2340);
        color: white;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .chat-container {
        width: 90%;
        max-width: 600px;
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(14px);
        padding: 25px;
        border-radius: 20px;
        box-shadow: 0 0 25px rgba(0, 150, 255, 0.4);
    }

    #chat {
        height: 320px;
        overflow-y: auto;
        padding: 10px;
        border-radius: 10px;
        background: rgba(0, 0, 0, 0.25);
        margin-bottom: 20px;
    }

    /* –°–û–û–ë–©–ï–ù–ò–Ø */
    .msg {
        display: flex;
        gap: 10px;
        align-items: flex-start;
        max-width: 86%;
        opacity: 0;
        transform: translateY(10px) scale(.98);
        animation: msgIn .25s forwards;
        margin-bottom: 12px;
    }

    @keyframes msgIn {
        to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .msg.user { margin-left: auto; flex-direction: row-reverse; }

    /* –ê–≤–∞—Ç–∞—Ä—ã */
    .avatar {
        width: 44px;
        height: 44px;
        border-radius: 50%;
        overflow: hidden;
        flex: 0 0 44px;
        background: linear-gradient(135deg,#0ee7c9,#1fa2ff);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 6px 18px rgba(0,0,0,0.35);
        transition: .25s;
    }
    .avatar img { width:100%; height:100%; object-fit:cover; }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –∞–≤–∞—Ç–∞—Ä–∞ –≤–æ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ */
    .avatar.speaking {
        animation: pulse 1s infinite;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.08); box-shadow: 0 0 18px #00d4ff; }
        100% { transform: scale(1); }
    }

    /* –û–±–ª–∞—á–∫–æ */
    .bubble {
        padding: 10px 14px;
        border-radius: 12px;
        background: rgba(255,255,255,0.08);
        line-height: 1.35;
        box-shadow: 0 6px 18px rgba(2,6,23,0.4);
    }

    .msg.user .bubble {
        background: linear-gradient(90deg,#00c2ff,#00ffa3);
        color: #002;
    }

    /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏ */
    .typing {
        width: 46px;
        height: 28px;
        border-radius: 10px;
        background: rgba(255,255,255,0.05);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
    }
    .dot {
        width: 8px; height: 8px;
        border-radius: 50%;
        background: #00d4ff;
        animation: dots 1s infinite;
    }
    .dot:nth-child(2){ animation-delay: .15s; }
    .dot:nth-child(3){ animation-delay: .3s; }

    @keyframes dots {
        0% { transform: translateY(0); opacity:.4; }
        50% { transform: translateY(-6px); opacity:1; }
        100% { transform: translateY(0); opacity:.4; }
    }

    /* –í–≤–æ–¥ */
    .input-area {
        display: flex;
        gap: 10px;
    }
    #userInput {
        flex: 1;
        padding: 12px;
        border-radius: 10px;
        border: none;
        font-size: 16px;
    }
    button {
        padding: 12px 15px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-weight: bold;
        transition: .2s;
    }
    button:hover { transform: scale(1.07); }

    #micBtn { background:#ff3b3b; }
    #speakBtn { background:#00ff99; }
</style>
</head>

<body>

<div class="chat-container">
    <h2 style="text-align:center; margin-top:0;">SmartHub AI</h2>

    <div id="chat"></div>

    <div class="input-area">
        <input id="userInput" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å..." />
        <button onclick="sendMessage()">‚û§</button>
        <button id="micBtn" onclick="voiceInput()">üé§</button>
        <button id="speakBtn" onclick="speakLast()">üîä</button>
    </div>
</div>

<script>
/* URL —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–∫—Å–∏ */
const API_URL = "https://smarthub-proxy.onrender.com/v1/responses";

/* –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ */
let lastAIMessage = "";
let speakingUtterance = null;

/* –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è */
function addMessage(text, role, typing=false) {
    const chat = document.getElementById("chat");

    const wrap = document.createElement("div");
    wrap.className = "msg " + role;

    const avatar = document.createElement("div");
    avatar.className = "avatar";

    const img = document.createElement("img");
    img.src = role === "user" ? "avatar-user.png" : "avatar-ai.png";
    avatar.appendChild(img);

    const bubble = document.createElement("div");
    bubble.className = "bubble";

    if (typing && role === "ai") {
        bubble.innerHTML = `
            <div class="typing">
                <div class="dot"></div><div class="dot"></div><div class="dot"></div>
            </div>`;
        avatar.classList.add("speaking");
    } else {
        bubble.textContent = text;
    }

    wrap.appendChild(avatar);
    wrap.appendChild(bubble);
    chat.appendChild(wrap);

    chat.scrollTop = chat.scrollHeight;

    return {avatar, bubble};
}

/* –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è */
async function sendMessage() {
    const input = document.getElementById("userInput");
    const text = input.value.trim();
    if (!text) return;

    addMessage(text, "user");
    input.value = "";

    // –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏
    const t = addMessage("", "ai", true);

    const res = await fetch(API_URL, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            model: "gpt-4o-mini",
            input: text
        })
    });

    const data = await res.json();

    // —É–±–∏—Ä–∞–µ–º typing-–∞–Ω–∏–º–∞—Ü–∏—é
    t.avatar.classList.remove("speaking");
    t.bubble.innerHTML = "";

    const ai = data.output[0].content[0].text;
    t.bubble.textContent = ai;

    lastAIMessage = ai; // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç –¥–ª—è –æ–∑–≤—É—á–∫–∏
}

/* –ì–û–õ–û–°–û–í–ê–Ø –û–ó–í–£–ß–ö–ê ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ –∫–Ω–æ–ø–∫–µ */
function speakLast(){
    if (!lastAIMessage) return alert("–ù–µ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –æ–∑–≤—É—á–∫–∏");
    speak(lastAIMessage);
}

function speak(text){
  try{
    stopSpeech();
    const synth = window.speechSynthesis;
    if(!synth) return;
    const u = new SpeechSynthesisUtterance(text);
    u.lang = 'ru-RU';
    u.rate = 1;
    u.pitch = 1;
    speakingUtterance = u;
    synth.speak(u);
    u.onend = () => { speakingUtterance = null; }
  }catch(e){ console.warn(e); }
}

function stopSpeech(){
  try{ 
    const s = window.speechSynthesis;
    if(s && s.speaking){
        s.cancel();
        speakingUtterance = null;
    } 
  }catch(e){ console.warn(e); }
}

/* –ì–û–õ–û–°–û–í–û–ô –í–í–û–î */
function voiceInput() {
    const Rec = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!Rec) return alert("–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏");

    const rec = new Rec();
    rec.lang = "ru-RU";
    rec.start();

    document.getElementById("micBtn").style.background = "#ffa200";

    rec.onresult = e => {
        document.getElementById("userInput").value = e.results[0][0].transcript;
    };

    rec.onend = () => {
        document.getElementById("micBtn").style.background = "#ff3b3b";
    };
}
</script>

</body>
</html>
